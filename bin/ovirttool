#!/bin/bash

set -e

if [ -z "$XLRINFRADIR" ]; then
  echo >&2 "Must set XLRINFRADIR"
  exit 1
fi

cd $XLRINFRADIR

if ! docker image inspect ovirttool >/dev/null 2>&1; then
    TMP=$(mktemp -d -t ovirtool.XXXXXX)
    docker build -t ovirttool -f $XLRINFRADIR/docker/ovirttool.df $TMP
fi
cd $XLRINFRADIR

# OVIRT_PASSWORD gets set in shell wrapper, allows tool to be non-interactive
docker run -it -e OVIRT_PASSWORD -v /netstore:/netstore -v $XLRINFRADIR:$XLRINFRADIR -w $XLRINFRADIR -u `id -u`:`id -g` --rm ovirttool ovirt/ovirttool.py "$@"
